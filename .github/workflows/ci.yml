name: CI - Lint, Format, Test, Build

on:

  push:

    branches: [ "main" ]

  pull_request:

    branches: [ "main" ]

jobs:

  quality-checks:

    runs-on: ubuntu-latest

    steps:

      # Step 1: Checkout repository

      - name: Checkout repository

        uses: actions/checkout@v4

      # Step 2: Set up Node.js (use Node 20 like your local machine)

      - name: Set up Node.js

        uses: actions/setup-node@v4

        with:

          node-version: 20

          cache: "npm"

      # Step 3: Clean npm cache (optional but helps prevent install issues)

      - name: Clean npm cache

        run: npm cache clean --force

      # Step 4: Install dependencies (skip strict peer dependency resolution)

      - name: Install dependencies

        run: npm install --legacy-peer-deps

      # Step 5: Run Prettier check

      - name: Run Prettier check

        run: npm run format:check

      # Step 6: Run ESLint (allow warnings but donâ€™t fail workflow)

      - name: Run ESLint

        run: npm run lint || true

      # Step 7: Run tests

      - name: Run tests

        run: npm test -- --watchAll=false

      # Step 8: Build production

      - name: Build production

        run: npm run build
